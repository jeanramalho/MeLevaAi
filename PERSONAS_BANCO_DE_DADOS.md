# üóÑÔ∏è Personas de Banco de Dados - MeLevaAi

**Vers√£o:** 1.0  
**Data:** Janeiro 2025  
**Desenvolvedor:** Jean Ramalho  
**Projeto:** Aplicativo iOS de Caronas Compartilhadas

---

## üìñ Sum√°rio Executivo

Este documento apresenta a modelagem de dados e personas do banco de dados do MeLevaAi, um aplicativo de caronas compartilhadas. O sistema utiliza Firebase Realtime Database como backend, implementando uma estrutura hier√°rquica otimizada para opera√ß√µes em tempo real e escalabilidade.

### Objetivos da Modelagem
- Definir estrutura de dados eficiente para opera√ß√µes em tempo real
- Garantir escalabilidade para crescimento de usu√°rios
- Otimizar consultas e sincroniza√ß√£o de dados
- Implementar seguran√ßa e integridade dos dados

---

## üèóÔ∏è Arquitetura do Banco de Dados

### Tecnologia Utilizada
- **Firebase Realtime Database**
- **Estrutura Hier√°rquica JSON**
- **Sincroniza√ß√£o em Tempo Real**
- **Regras de Seguran√ßa Configur√°veis**

### Princ√≠pios de Design
- **Denormaliza√ß√£o Controlada**: Dados duplicados para performance
- **Hierarquia L√≥gica**: Organiza√ß√£o por entidades principais
- **Chaves Sem√¢nticas**: IDs descritivos quando poss√≠vel
- **Timestamps Autom√°ticos**: Controle temporal de dados

---

## üë• Personas de Dados

### 1. üë§ Usu√°rios (usuarios)

**Descri√ß√£o:** Entidade central que armazena informa√ß√µes b√°sicas de todos os usu√°rios do sistema.

```json
{
  "usuarios": {
    "userId": {
      "nome": "Jo√£o Silva",
      "email": "joao.silva@email.com",
      "motorista": true,
      "dataCadastro": "2025-01-15T10:30:00Z",
      "ultimaAtualizacao": "2025-01-15T10:30:00Z"
    }
  }
}
```

**Campos:**
- `nome` (String): Nome completo do usu√°rio
- `email` (String): Email √∫nico para autentica√ß√£o
- `motorista` (Boolean): Flag que define o tipo de usu√°rio
- `dataCadastro` (Timestamp): Data de cria√ß√£o da conta
- `ultimaAtualizacao` (Timestamp): √öltima modifica√ß√£o do perfil

**Relacionamentos:**
- 1:N com `requisicoes` (via email)
- 1:N com `motoristas.corridasConcluidas` (se motorista)

**Opera√ß√µes Principais:**
- CREATE: Durante cadastro de usu√°rio
- READ: Verifica√ß√£o de perfil e autentica√ß√£o
- UPDATE: Atualiza√ß√£o de dados pessoais
- DELETE: Remo√ß√£o de conta (soft delete recomendado)

---

### 2. üöó Requisi√ß√µes (requisicoes)

**Descri√ß√£o:** Entidade que gerencia todas as solicita√ß√µes de caronas, desde cria√ß√£o at√© conclus√£o.

```json
{
  "requisicoes": {
    "requestId": {
      "email": "maria.passageiro@email.com",
      "nome": "Maria Santos",
      "latitude": "-23.5505",
      "longitude": "-46.6333",
      "destinyLatitude": "-23.5615",
      "destinyLongitude": "-46.6565",
      "status": "pendente",
      "motoristaLatitude": null,
      "motoristaLongitude": null,
      "dataCriacao": "2025-01-15T14:20:00Z",
      "ultimaAtualizacao": "2025-01-15T14:20:00Z"
    }
  }
}
```

**Campos:**
- `email` (String): Email do passageiro solicitante
- `nome` (String): Nome do passageiro
- `latitude/longitude` (String): Coordenadas de origem
- `destinyLatitude/destinyLongitude` (String): Coordenadas de destino
- `status` (String): Estado atual da corrida
- `motoristaLatitude/motoristaLongitude` (Number): Posi√ß√£o do motorista (quando aceita)
- `dataCriacao` (Timestamp): Momento da solicita√ß√£o
- `ultimaAtualizacao` (Timestamp): √öltima modifica√ß√£o

**Estados Poss√≠veis:**
- `pendente`: Aguardando aceita√ß√£o
- `aceita`: Motorista a caminho
- `em_andamento`: Corrida em progresso
- `concluida`: Finalizada

**Opera√ß√µes Principais:**
- CREATE: Nova solicita√ß√£o de carona
- READ: Listagem para motoristas
- UPDATE: Mudan√ßas de status e localiza√ß√£o
- DELETE: Cancelamento ou conclus√£o

---

### 3. üèÜ Motoristas (motoristas)

**Descri√ß√£o:** Entidade especializada para armazenar hist√≥rico e dados espec√≠ficos de motoristas.

```json
{
  "motoristas": {
    "joao_silva_email_com": {
      "corridasConcluidas": {
        "rideId1": {
          "passageiroNome": "Maria Santos",
          "passageiroEmail": "maria.santos@email.com",
          "origemLatitude": "-23.5505",
          "origemLongitude": "-46.6333",
          "destinoLatitude": "-23.5615",
          "destinoLongitude": "-46.6565",
          "motoristaNome": "Jo√£o Silva",
          "motoristaEmail": "joao.silva@email.com",
          "status": "concluida",
          "concluidaEm": "2025-01-15T16:45:00Z",
          "rideId": "rideId1"
        }
      },
      "estatisticas": {
        "totalCorridas": 15,
        "avaliacaoMedia": 4.8,
        "ultimaAtividade": "2025-01-15T16:45:00Z"
      }
    }
  }
}
```

**Campos:**
- `corridasConcluidas` (Object): Hist√≥rico de corridas
- `estatisticas` (Object): M√©tricas do motorista
- `totalCorridas` (Number): Contador de corridas
- `avaliacaoMedia` (Number): M√©dia de avalia√ß√µes
- `ultimaAtividade` (Timestamp): √öltima corrida

**Opera√ß√µes Principais:**
- CREATE: Primeira corrida do motorista
- READ: Hist√≥rico e estat√≠sticas
- UPDATE: Adi√ß√£o de novas corridas
- DELETE: Raramente utilizado

---

## üîÑ Fluxos de Dados

### Fluxo 1: Solicita√ß√£o de Carona
```mermaid
graph TD
    A[Passageiro solicita carona] --> B[Cria registro em requisicoes]
    B --> C[Status: pendente]
    C --> D[Motoristas visualizam lista]
    D --> E[Motorista aceita]
    E --> F[Atualiza status para aceita]
    F --> G[Adiciona coordenadas do motorista]
```

### Fluxo 2: Conclus√£o de Corrida
```mermaid
graph TD
    A[Motorista finaliza corrida] --> B[Salva dados em motoristas]
    B --> C[Atualiza status para concluida]
    C --> D[Remove da lista de requisicoes]
    D --> E[Atualiza estat√≠sticas do motorista]
```

---

## üîç Consultas e Opera√ß√µes

### Consultas Frequentes

#### 1. Buscar Requisi√ß√µes Pendentes
```javascript
// Firebase Query
database.ref('requisicoes')
  .orderByChild('status')
  .equalTo('pendente')
  .on('value', callback);
```

#### 2. Buscar Requisi√ß√µes por Passageiro
```javascript
// Firebase Query
database.ref('requisicoes')
  .orderByChild('email')
  .equalTo('passageiro@email.com')
  .on('value', callback);
```

#### 3. Hist√≥rico de Corridas do Motorista
```javascript
// Firebase Query
database.ref('motoristas')
  .child('motorista_email_com')
  .child('corridasConcluidas')
  .orderByChild('concluidaEm')
  .limitToLast(10)
  .on('value', callback);
```

### Opera√ß√µes de Escrita

#### 1. Criar Nova Requisi√ß√£o
```javascript
const newRequest = {
  email: userEmail,
  nome: userName,
  latitude: currentLatitude,
  longitude: currentLongitude,
  destinyLatitude: destinationLatitude,
  destinyLongitude: destinationLongitude,
  status: 'pendente',
  dataCriacao: ServerValue.timestamp()
};

database.ref('requisicoes').push(newRequest);
```

#### 2. Atualizar Status da Corrida
```javascript
const updates = {
  status: 'aceita',
  motoristaLatitude: driverLatitude,
  motoristaLongitude: driverLongitude,
  ultimaAtualizacao: ServerValue.timestamp()
};

database.ref('requisicoes').child(requestId).update(updates);
```

---

## üìä Otimiza√ß√µes de Performance

### 1. Estrutura Hier√°rquica
- **Vantagem**: Consultas mais r√°pidas por proximidade
- **Implementa√ß√£o**: Dados organizados por entidade principal
- **Exemplo**: `requisicoes/requestId` vs `requisicoes/status/pendente/requestId`

### 2. Denormaliza√ß√£o Controlada
- **Vantagem**: Reduz n√∫mero de consultas
- **Implementa√ß√£o**: Dados duplicados quando necess√°rio
- **Exemplo**: Nome do passageiro em `requisicoes` e `motoristas.corridasConcluidas`

### 3. √çndices Estrat√©gicos
- **Campo**: `status` em `requisicoes`
- **Campo**: `email` em `requisicoes`
- **Campo**: `concluidaEm` em `motoristas.corridasConcluidas`

### 4. Pagina√ß√£o de Dados
- **Implementa√ß√£o**: `limitToLast()` para hist√≥rico
- **Benef√≠cio**: Reduz transfer√™ncia de dados
- **Uso**: Listagem de corridas conclu√≠das

---

## üîí Seguran√ßa e Regras

### Regras de Seguran√ßa Firebase

```javascript
{
  "rules": {
    "usuarios": {
      "$uid": {
        ".read": "auth != null && auth.uid == $uid",
        ".write": "auth != null && auth.uid == $uid"
      }
    },
    "requisicoes": {
      ".read": "auth != null",
      ".write": "auth != null",
      "$requestId": {
        ".validate": "newData.hasChildren(['email', 'nome', 'status'])"
      }
    },
    "motoristas": {
      ".read": "auth != null",
      ".write": "auth != null"
    }
  }
}
```

### Valida√ß√µes de Dados
- **Email**: Formato v√°lido obrigat√≥rio
- **Coordenadas**: Valores num√©ricos v√°lidos
- **Status**: Valores pr√©-definidos apenas
- **Timestamps**: Valores autom√°ticos do servidor

---

## üìà M√©tricas e Monitoramento

### KPIs do Banco de Dados
- **N√∫mero de Requisi√ß√µes**: Contagem de solicita√ß√µes por per√≠odo
- **Taxa de Aceita√ß√£o**: Percentual de corridas aceitas
- **Tempo M√©dio de Resposta**: Performance das consultas
- **Uso de Armazenamento**: Crescimento do banco de dados

### Alertas Configurados
- **Alto Volume de Requisi√ß√µes**: > 100/minuto
- **Erro de Conex√£o**: Falhas de sincroniza√ß√£o
- **Uso de Quota**: Aproxima√ß√£o dos limites do Firebase
- **Consultas Lentas**: Tempo de resposta > 2 segundos

---

## üîÆ Evolu√ß√£o e Melhorias Futuras

### Melhorias Planejadas
1. **Sistema de Avalia√ß√µes**: Nova entidade para ratings
2. **Chat em Tempo Real**: Mensagens entre usu√°rios
3. **Notifica√ß√µes Push**: Sistema de alertas
4. **Analytics Avan√ßados**: M√©tricas detalhadas de uso
5. **Backup Autom√°tico**: Sincroniza√ß√£o com Cloud Storage

### Considera√ß√µes de Escalabilidade
- **Sharding**: Divis√£o por regi√£o geogr√°fica
- **Cache**: Implementa√ß√£o de Redis para consultas frequentes
- **CDN**: Distribui√ß√£o de dados est√°ticos
- **Microservi√ßos**: Separa√ß√£o de responsabilidades

---

## üìã Checklist de Implementa√ß√£o

### ‚úÖ Funcionalidades Implementadas
- [x] Estrutura b√°sica de usu√°rios
- [x] Sistema de requisi√ß√µes completo
- [x] Hist√≥rico de motoristas
- [x] Valida√ß√µes de dados
- [x] Regras de seguran√ßa
- [x] Consultas otimizadas
- [x] Sincroniza√ß√£o em tempo real

### üîÑ Em Desenvolvimento
- [ ] Sistema de avalia√ß√µes
- [ ] M√©tricas avan√ßadas
- [ ] Backup automatizado
- [ ] Monitoramento de performance

### üìÖ Pr√≥ximas Etapas
- [ ] Implementa√ß√£o de cache
- [ ] Otimiza√ß√£o de consultas
- [ ] Testes de carga
- [ ] Documenta√ß√£o de APIs

---

## üìö Refer√™ncias e Documenta√ß√£o

### Documenta√ß√£o T√©cnica
- [Firebase Realtime Database Documentation](https://firebase.google.com/docs/database)
- [Firebase Security Rules](https://firebase.google.com/docs/database/security)
- [Firebase Performance Monitoring](https://firebase.google.com/docs/perf-mon)

### Padr√µes Utilizados
- **RESTful API**: Princ√≠pios de design de APIs
- **ACID Properties**: Consist√™ncia de dados
- **CAP Theorem**: Balanceamento de consist√™ncia e disponibilidade
- **Event Sourcing**: Rastreamento de mudan√ßas de estado

---

**Documento elaborado por:** Jean Ramalho  
**Data de cria√ß√£o:** Janeiro 2025  
**Pr√≥xima revis√£o:** Conforme evolu√ß√£o do projeto
